# 산출물 작성 작업 지침

## 1. 개요
본 지침은 인터페이스 명세서, 테이블 명세서 등 다양한 산출물 작성에 필요한 표준 절차와 방법을 안내합니다. 작성된 산출물은 지정된 형식과 경로로 저장되어야 합니다.

## 2. 산출물 유형 및 요청 방법
다음 산출물 유형이 지원됩니다:

### 2.1 인터페이스 명세서
- 요청 방법: "인터페이스 명세서 작성해줘" 또는 "XXX 시스템 연동을 위한 인터페이스 명세서 작성"
- 필요 도구: `interface_spec` 도구를 통해 템플릿 제공
- 산출물 파일이름 및 양식: INF_KDI_BI_XXX (XXX부분은 "D:\KDI\docs\인터페이스 정의서" 기존문서의 마지막 번호 +1)
- **응답 필드 정의**: 구현 메서드가 호출하는 *SQL/JPQL/QueryDSL* 쿼리를 자동 탐색하여 `SELECT` 절 컬럼 → JSON 응답 필드 표로 작성
- **테이블 명세서 작성은 자동이 아닌 별도 명령으로 수행**합니다. (예: "해당 테이블 명세서 작성해줘")
- **문서 번호는 MCP 서버가 자동 채번하여 `document_number` 필드로 반환**합니다. Agent 는 이를 그대로 사용해 파일명을 생성하면 됩니다.
- MCP 가 함께 제공하는 `suggested_path`(`D:\KDI\docs\인터페이스 정의서\`)에 저장하세요.

### 2.2 테이블 명세서 (별도 요청)
- 요청 방법: "`KDW.USER` 테이블 명세서 작성해줘" 또는 여러 테이블을 지정
- 필요 도구: `table_spec`(템플릿) + `table_schema`(스키마 조회)
- 산출물 파일이름 및 양식: TBL_KDI_BI_{테이블명}.md , 각 테이블마다 별도 파일 저장

### 2.3 기타 산출물
- 추후 지원 예정

## 3. 인터페이스 명세서 작성 절차

### 3.1 기본 정보 작성
- 인터페이스 ID: 'INF_KDI_BI_XXX' 형식으로 순번 부여
- 작성일자: 현재 날짜 자동 기입
- 작성자: 이주형
- 버전:v1.0 
- 인터페이스명: 목적과 동작을 간결하게 표현 (예: '매출 데이터 ETL 인터페이스')

### 3.2 시스템 정보 작성
- 송신 시스템: 데이터를 제공하는 시스템 (예: 'KDW', 'Oracle DW', 'MySQL DB')
- 수신 시스템: 데이터를 받는 시스템 (예: 'BI 대시보드', 'ETL 서버')

### 3.3 연동 방식 상세화
- 연동 방식: 데이터 전송 방식 (예: 'DB Link', 'API 호출', 'ETL 배치작업')
- 전송 주기: 주기적 실행 여부 (예: '매일 00시', '매주 월요일 03시', '실시간')
- 데이터 양: 예상되는 데이터 처리량 명시 (예: '일 100만 건', '총 10GB')

### 3.4 관련 테이블 명시 (→ 테이블 명세서 별도 작성 가능)

### 3.5 처리 로직 기술
- 데이터 추출 조건 (WHERE 절 등)
- 데이터 변환 규칙 (타입 변환, 포맷 변경)
- 예외 처리 방법
- 에러 발생 시 대응 방안

### 3.6 응답 필드 자동 생성
1. 대상 메서드에서 실행되는 쿼리 파일(.sql) 또는 인라인 SQL을 검색합니다.
2. `SELECT` 절의 컬럼·alias 를 추출 → "응답 정보" 표에 매핑합니다.
3. 컬럼 설명은 DB 주석 혹은 코드 주석을 활용해 작성합니다.

## 4. 테이블 스키마 정보 조회 방법

### 4.1 데이터베이스 연결 정보 확인
- 연결 코드를 통해 데이터베이스 종류를 식별합니다:
  - DB2 연결: `DBConnection.get_db2_engine()`
  - Oracle 연결: `DBConnection.execute_oracle_query()`
  - MySQL 연결: `DBConnection.get_mysql_engine()`

### 4.2 테이블 스키마 요청 형식
- 단일 테이블: 'DB2/KDW.테이블명' 또는 'ORACLE/테이블명'(스키마 생략 시)
- 여러 테이블: 'DB2/KDW.테이블명,ORACLE/KSHOP.테이블명,MYSQL/KDI.테이블명'
- Agent에 요청 시: "DB2/KDW.TABLE1과 ORACLE/KSHOP.TABLE2의 테이블 스키마 조회해줘"

### 4.3 데이터베이스 연결 예제와 테이블 요청 패턴
- DB2 연결 코드 발견 시: 'DB2/테이블명' 형식으로 요청 ('DB2/KDW.테이블명')
- Oracle 연결 코드 발견 시: 'ORACLE/테이블명' 형식으로 요청 ('ORACLE/KSHOP.테이블명')
- MySQL 연결 코드 발견 시: 'MYSQL/테이블명' 형식으로 요청 ('MYSQL/KDI.테이블명')
- 여러 DB 연결이 있을 경우 관련된 모든 테이블을 콤마로 구분하여 요청

### 4.4 테이블 명세서 통합
- 조회된 테이블 스키마 정보를 인터페이스 명세서에 활용
- 별도의 테이블 명세서 파일이 필요한 경우 생성

## 5. 산출물 저장 규칙

### 5.1 파일 명명 규칙
- 인터페이스 명세서: 'INF_KDI_BI_XXX_인터페이스명.md'
- 테이블 명세서: 'TBL_KDI_BI_XXX_테이블명.md'
- 순번(XXX)은 항상 3자리 숫자로 표현 (예: '001', '023', '105')

### 5.2 저장 경로
- 인터페이스 명세서: 'D:\KDI\docs\인터페이스 정의서\'
- 테이블 명세서: 'D:\KDI\docs\테이블명세서\'
- 저장 시 기존 파일이 있는 경우 덮어쓰기 전 백업 생성

### 5.3 순번 관리
- 기존 문서들의 순번(XXX 부분)을 확인하여 마지막 번호에 1을 더한 값 사용
- 관련 문서 간 순번 일치시킴

## 6. 작업 예시 및 흐름도

### 6.1 인터페이스 명세서 작성 흐름
1. 사용자: "매출 데이터 ETL용 인터페이스 명세서 작성해줘"
2. Agent: `interface_spec` 도구를 호출하여 템플릿과 지침 확인
3. Agent: 템플릿에 따라 인터페이스 명세서 초안 작성
4. Agent: 코드에서 DB 연결 정보 확인 (DB2, Oracle, MySQL 등)
5. Agent: "테이블 스키마 정보가 필요합니다. DB2/KDW.TABLE1과 같이 조회할 테이블을 알려주세요."
6. 사용자: "DB2/KDW.SALES_DATA와 ORACLE/KSHOP.PRODUCT 테이블 스키마 조회해줘"
7. Agent: `table_schema` 도구를 호출하여 테이블 스키마 정보 조회
8. Agent: 조회된 정보를 인터페이스 명세서에 필요정보 활용
9. Agent: 지정된 경로에 적절한 파일명으로 문서 저장
10. Agent: 완료된 산출물 파일 경로와 주요 내용 요약 제공

### 6.2 산출물 작성 시 주의사항
- 테이블명은 대소문자를 구분하지 않습니다.
- 코드에서 DB 연결 정보를 찾아 적절한 DB 유형을 요청에 포함해야 합니다.
- 누락된 정보가 있을 경우 사용자에게 추가 정보 요청하세요.
- 완성된 문서는 Markdown 형식으로 저장합니다.
- 필요 시 관련 SQL 쿼리를 문서에 포함하세요.
- 산출물 파일 생성 후 저장 경로와 파일명을 반드시 안내하세요.

### 6.3 인터페이스 명세서 작성 흐름 (테이블 명세서는 별도)
1. 사용자: "매출 데이터 ETL용 인터페이스 명세서 작성해줘"
2. Agent: `interface_spec` 호출 → 템플릿 수신
3. Agent: 소스 코드 분석 → 쿼리 추출 → 응답 필드 표 자동 구성
4. 필요 DB 스키마 조회 시 `table_schema` 호출(선택)
5. 문서 저장
6. **테이블 명세서 작성이 필요하면** -> 사용자 또는 Agent 가 "테이블 명세서 작성" 명령을 별도로 호출